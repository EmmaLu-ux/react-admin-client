{"ast":null,"code":"import _classCallCheck from\"/Users/emmalu/Documents/fronted/workspace/react-admin_client-1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/emmalu/Documents/fronted/workspace/react-admin_client-1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/emmalu/Documents/fronted/workspace/react-admin_client-1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/emmalu/Documents/fronted/workspace/react-admin_client-1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{EditorState,convertToRaw,ContentState}from\"draft-js\";import{Editor}from\"react-draft-wysiwyg\";import\"react-draft-wysiwyg/dist/react-draft-wysiwyg.css\";import draftToHtml from\"draftjs-to-html\";import htmlToDraft from\"html-to-draftjs\";/* 富文本编辑器---用来指定商品详情组件 */var RichTextEditor=/*#__PURE__*/function(_Component){_inherits(RichTextEditor,_Component);var _super=_createSuper(RichTextEditor);function RichTextEditor(props){var _this;_classCallCheck(this,RichTextEditor);_this=_super.call(this,props);_this.state={editorState:EditorState.createEmpty()//创建一个没有内容的编辑对象\n};_this.onEditorStateChange=function(editorState){_this.setState({editorState:editorState});};_this.uploadImageCallBack=function(file){return new Promise(function(resolve,reject){//发起上传图片的ajax请求\nvar xhr=new XMLHttpRequest();xhr.open(\"POST\",\"/api/manage/img/upload\");var data=new FormData();data.append(\"image\",file);xhr.send(data);xhr.addEventListener(\"load\",function(){var response=JSON.parse(xhr.responseText);var url=response.data.url;//得到图片的url\n// resolve(url);\nresolve({data:{link:url}});});xhr.addEventListener(\"error\",function(){var error=JSON.parse(xhr.responseText);reject(error);});});};_this.getDetail=function(){//返回输入数据对应的html格式的文本\nreturn draftToHtml(convertToRaw(_this.state.editorState.getCurrentContent()));};var html=_this.props.detail;// const contentBlock = htmlToDraft(html);\nif(html){//如果有值，根据html格式字符串创建一个对应的编辑对象\nvar contentBlock=htmlToDraft(html);if(contentBlock){var contentState=ContentState.createFromBlockArray(contentBlock.contentBlocks);var editorState=EditorState.createWithContent(contentState);_this.state={editorState:editorState};}}else{_this.state={editorState:EditorState.createEmpty()};}return _this;}/* 输入过程中实时的回调 */_createClass(RichTextEditor,[{key:\"render\",value:function render(){var editorState=this.state.editorState;return/*#__PURE__*/React.createElement(Editor,{editorState:editorState,editorStyle:{border:\"none\",backgroundColor:\"rgb(247, 248, 252)\",height:200,paddingLeft:10},onEditorStateChange:this.onEditorStateChange,toolbar:{image:{uploadCallback:this.uploadImageCallBack,alt:{present:true,mandatory:true}}}});}}]);return RichTextEditor;}(Component);export{RichTextEditor as default};","map":{"version":3,"names":["React","Component","EditorState","convertToRaw","ContentState","Editor","draftToHtml","htmlToDraft","RichTextEditor","props","state","editorState","createEmpty","onEditorStateChange","setState","uploadImageCallBack","file","Promise","resolve","reject","xhr","XMLHttpRequest","open","data","FormData","append","send","addEventListener","response","JSON","parse","responseText","url","link","error","getDetail","getCurrentContent","html","detail","contentBlock","contentState","createFromBlockArray","contentBlocks","createWithContent","border","backgroundColor","height","paddingLeft","image","uploadCallback","alt","present","mandatory"],"sources":["/Users/emmalu/Documents/fronted/workspace/react-admin_client-1/src/pages/product/rich-text-editor.jsx"],"sourcesContent":["import React, { Component } from \"react\";\nimport { EditorState, convertToRaw, ContentState } from \"draft-js\";\nimport { Editor } from \"react-draft-wysiwyg\";\nimport \"react-draft-wysiwyg/dist/react-draft-wysiwyg.css\";\nimport draftToHtml from \"draftjs-to-html\";\nimport htmlToDraft from \"html-to-draftjs\";\nimport PropTypes from \"prop-types\";\n\n/* 富文本编辑器---用来指定商品详情组件 */\nexport default class RichTextEditor extends Component {\n  static propTypes = {\n    detail: PropTypes.string,\n  };\n  state = {\n    editorState: EditorState.createEmpty(), //创建一个没有内容的编辑对象\n  };\n  constructor(props) {\n    super(props);\n    const html = this.props.detail;\n    // const contentBlock = htmlToDraft(html);\n    if (html) {  //如果有值，根据html格式字符串创建一个对应的编辑对象\n      const contentBlock = htmlToDraft(html);\n      if (contentBlock) {\n        const contentState = ContentState.createFromBlockArray(\n          contentBlock.contentBlocks\n        );\n        const editorState = EditorState.createWithContent(contentState);\n        this.state = {\n          editorState,\n        };\n      }\n    } else {\n      this.state = {\n        editorState: EditorState.createEmpty(),\n      };\n    }\n  }\n  /* 输入过程中实时的回调 */\n  onEditorStateChange = (editorState) => {\n    this.setState({\n      editorState,\n    });\n  };\n  uploadImageCallBack = (file) => {\n    return new Promise((resolve, reject) => {\n      //发起上传图片的ajax请求\n      const xhr = new XMLHttpRequest();\n      xhr.open(\"POST\", \"/api/manage/img/upload\");\n      const data = new FormData();\n      data.append(\"image\", file);\n      xhr.send(data);\n      xhr.addEventListener(\"load\", () => {\n        const response = JSON.parse(xhr.responseText);\n        const url = response.data.url //得到图片的url\n        // resolve(url);\n        resolve({data: {link: url}})\n      });\n      xhr.addEventListener(\"error\", () => {\n        const error = JSON.parse(xhr.responseText);\n        reject(error);\n      });\n    });\n  };\n  getDetail = () => {\n    //返回输入数据对应的html格式的文本\n    return draftToHtml(\n      convertToRaw(this.state.editorState.getCurrentContent())\n    );\n  };\n  render() {\n    const { editorState } = this.state;\n    return (\n      <Editor\n        editorState={editorState}\n        editorStyle={{\n          border: \"none\",\n          backgroundColor: \"rgb(247, 248, 252)\",\n          height: 200,\n          paddingLeft: 10,\n        }}\n        onEditorStateChange={this.onEditorStateChange}\n        toolbar={{\n          image: {\n            uploadCallback: this.uploadImageCallBack,\n            alt: { present: true, mandatory: true },\n          },\n        }}\n      />\n    );\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}