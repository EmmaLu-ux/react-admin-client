{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/upload/style\";\nimport _Upload from \"antd/es/upload\";\nimport \"antd/es/icon/style\";\nimport _Icon from \"antd/es/icon\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nvar _jsxFileName = \"/Users/emmalu/Documents/fronted/workspace/react-admin_client-1/src/pages/product/pictures-wall.jsx\";\nimport React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { reqDeleteImg } from \"../../api\";\nimport { BASE_IMG_URL } from '../../utils/constants.js';\nfunction getBase64(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = error => reject(error);\n  });\n}\nexport default class PicturesWall extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      previewVisible: false,\n      //标识是否显示大图预览\n      previewImage: \"\",\n      //大图的url\n      fileList: [\n        //   {\n        //     uid: \"-1\", //每个file都有自己唯一的id，建议设置为负数，防止和内部产生的id冲突\n        //     name: \"image.png\", //图片文件名\n        //     status: \"done\", //图片状态：done-已上传，uploading-正在上传中，removed-已删除，error-错误\n        //     url: \"https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png\", //图片地址\n        //   },\n      ]\n    };\n    this.getImgs = () => {\n      return this.state.fileList.map(file => file.name);\n    };\n    this.handleCancel = () => this.setState({\n      previewVisible: false\n    });\n    this.handlePreview = async file => {\n      if (!file.url && !file.preview) {\n        file.preview = await getBase64(file.originFileObj);\n      }\n      this.setState({\n        previewImage: file.url || file.preview,\n        previewVisible: true\n      });\n    };\n    this.handleChange = async _ref => {\n      let {\n        file,\n        fileList\n      } = _ref;\n      console.log(\"handleChange()\", file.status, fileList.length, file === fileList[fileList.length - 1]);\n      //一旦上传成功，将当前上传的file的信息修正(name, url)\n      if (file.status === \"done\") {\n        const result = file.response; //{status: 0, data: {name: xxx.png, url: '图片地址'}}\n        if (result.status === 0) {\n          _message.success(\"上传图片成功！\");\n          const {\n            name,\n            url\n          } = result.data;\n          file = fileList[fileList.length - 1];\n          file.name = name;\n          file.url = url;\n        } else {\n          _message.error(\"上传图片失败！\");\n        }\n      } else if (file.status === \"removed\") {\n        //删除图片\n        const result = await reqDeleteImg(file.name);\n        if (result.status === 0) {\n          _message.success(\"删除图片成功！\");\n        } else {\n          _message.error(\"删除图片失败！\");\n        }\n      }\n      //在操作（上传/删除）过程中更新fileList的状态\n      this.setState({\n        fileList\n      });\n    };\n    let _fileList = [];\n    //如果传入了imgs\n    const {\n      imgs\n    } = this.props;\n    if (imgs && imgs.length > 0) {\n      _fileList = imgs.map((img, index) => ({\n        uid: -index,\n        name: img,\n        status: 'done',\n        url: BASE_IMG_URL + img\n      }));\n    }\n    this.state = {\n      previewVisible: false,\n      //标识是否显示大图预览\n      previewImage: \"\",\n      //大图的url\n      fileList: _fileList\n    };\n  }\n  render() {\n    const {\n      previewVisible,\n      previewImage,\n      fileList\n    } = this.state;\n    const uploadButton = /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(_Icon, {\n      type: \"plus\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }\n    }, \"Upload\"));\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(_Upload, {\n      action: \"/manage/img/upload\" //上传图片的接口地址\n      ,\n      accept: \"image/*\" //只接收图片类型的文件\n      ,\n      name: \"image\" //请求参数名\n      ,\n      listType: \"picture-card\" //卡片样式\n      ,\n      fileList: fileList //所有已上传图片文件对象的数组\n      ,\n      onPreview: this.handlePreview,\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 9\n      }\n    }, fileList.length >= 3 ? null : uploadButton), /*#__PURE__*/React.createElement(_Modal, {\n      visible: previewVisible,\n      footer: null,\n      onCancel: this.handleCancel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      alt: \"example\",\n      style: {\n        width: \"100%\"\n      },\n      src: previewImage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 11\n      }\n    })));\n  }\n}\nPicturesWall.propTypes = {\n  imgs: PropTypes.array\n};","map":{"version":3,"names":["React","Component","PropTypes","reqDeleteImg","BASE_IMG_URL","getBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","PicturesWall","constructor","props","state","previewVisible","previewImage","fileList","getImgs","map","name","handleCancel","setState","handlePreview","url","preview","originFileObj","handleChange","console","log","status","length","response","success","data","imgs","img","index","uid","render","uploadButton","width","propTypes","array"],"sources":["/Users/emmalu/Documents/fronted/workspace/react-admin_client-1/src/pages/product/pictures-wall.jsx"],"sourcesContent":["import React, { Component } from \"react\";\nimport { Upload, Icon, Modal, message } from \"antd\";\nimport PropTypes from \"prop-types\";\n\nimport { reqDeleteImg } from \"../../api\";\nimport {BASE_IMG_URL} from '../../utils/constants.js'\n\nfunction getBase64(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = (error) => reject(error);\n  });\n}\n\nexport default class PicturesWall extends Component {\n  static propTypes = {\n    imgs: PropTypes.array,\n  };\n  state = {\n    previewVisible: false, //标识是否显示大图预览\n    previewImage: \"\", //大图的url\n    fileList: [\n      //   {\n      //     uid: \"-1\", //每个file都有自己唯一的id，建议设置为负数，防止和内部产生的id冲突\n      //     name: \"image.png\", //图片文件名\n      //     status: \"done\", //图片状态：done-已上传，uploading-正在上传中，removed-已删除，error-错误\n      //     url: \"https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png\", //图片地址\n      //   },\n    ],\n  };\n  constructor(props) {\n    super(props);\n    let fileList = []\n    //如果传入了imgs\n    const {imgs} = this.props\n    if(imgs && imgs.length > 0){\n        fileList = imgs.map((img, index) => ({\n            uid: -index,\n            name: img,\n            status: 'done',\n            url: BASE_IMG_URL + img\n        }))\n    }\n    this.state = {\n      previewVisible: false, //标识是否显示大图预览\n      previewImage: \"\", //大图的url\n      fileList\n    };\n  }\n  getImgs = () => {\n    return this.state.fileList.map(file => file.name);\n  };\n  /* 隐藏Modal */\n  handleCancel = () => this.setState({ previewVisible: false });\n\n  /* 显示指定file对应的大图 */\n  handlePreview = async (file) => {\n    if (!file.url && !file.preview) {\n      file.preview = await getBase64(file.originFileObj);\n    }\n\n    this.setState({\n      previewImage: file.url || file.preview,\n      previewVisible: true,\n    });\n  };\n\n  /* file: 当前操作的图片文件（上传/删除）\n  fileList: 所有已上传图片文件对象的数组 */\n  handleChange = async ({ file, fileList }) => {\n    console.log(\n      \"handleChange()\",\n      file.status,\n      fileList.length,\n      file === fileList[fileList.length - 1]\n    );\n    //一旦上传成功，将当前上传的file的信息修正(name, url)\n    if(file.status === \"done\") {\n      const result = file.response; //{status: 0, data: {name: xxx.png, url: '图片地址'}}\n      if(result.status === 0) {\n        message.success(\"上传图片成功！\");\n        const { name, url } = result.data;\n        file = fileList[fileList.length - 1];\n        file.name = name;\n        file.url = url;\n      } else {\n        message.error(\"上传图片失败！\");\n      }\n    } else if (file.status === \"removed\") {\n      //删除图片\n      const result = await reqDeleteImg(file.name);\n      if (result.status === 0) {\n        message.success(\"删除图片成功！\");\n      } else {\n        message.error(\"删除图片失败！\");\n      }\n    }\n    //在操作（上传/删除）过程中更新fileList的状态\n    this.setState({ fileList });\n  };\n  render() {\n    const { previewVisible, previewImage, fileList } = this.state;\n    const uploadButton = (\n      <div>\n        <Icon type=\"plus\" />\n        <div>Upload</div>\n      </div>\n    );\n    return (\n      <div>\n        <Upload\n          action=\"/manage/img/upload\" //上传图片的接口地址\n          accept=\"image/*\" //只接收图片类型的文件\n          name=\"image\" //请求参数名\n          listType=\"picture-card\" //卡片样式\n          fileList={fileList} //所有已上传图片文件对象的数组\n          onPreview={this.handlePreview}\n          onChange={this.handleChange}\n        >\n          {fileList.length >= 3 ? null : uploadButton}\n        </Upload>\n        <Modal\n          visible={previewVisible}\n          footer={null}\n          onCancel={this.handleCancel}\n        >\n          <img alt=\"example\" style={{ width: \"100%\" }} src={previewImage} />\n        </Modal>\n      </div>\n    );\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}