{"ast":null,"code":"import \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nvar _jsxFileName = \"/Users/emmalu/Documents/fronted/workspace/react-admin_client-1/src/pages/user/user.jsx\";\nimport React, { Component } from \"react\";\nimport { formateDate } from \"../../utils/dateUtils\";\nimport { PAGE_SIZE } from \"../../utils/constants\";\nimport { reqDeleteUser, reqUsers, reqAddOrUpdateUser } from \"../../api\";\nimport LinkButton from \"../../components/link-button/index\";\nimport UserForm from \"./user-form\";\n\n/* 用户管理路由 */\nexport default class User extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      users: [],\n      //需要展示的用户信息\n      roles: [],\n      //所有角色列表\n      isShow: false //是否显示添加/更新用户列表\n    };\n    this.initColumns = () => {\n      this.columns = [{\n        title: \"用户名\",\n        dataIndex: \"username\"\n      }, {\n        title: \"邮箱\",\n        dataIndex: \"email\"\n      }, {\n        title: \"电话\",\n        dataIndex: \"phone\"\n      }, {\n        title: \"注册时间\",\n        dataIndex: \"create_time\",\n        render: formateDate\n      }, {\n        title: \"所属角色\",\n        dataIndex: \"role_id\",\n        // render: (role_id) => this.state.roles.find(role => role._id === role_id).name\n        render: role_id => this.roleNames[role_id]\n      }, {\n        title: \"操作\",\n        render: user => /*#__PURE__*/React.createElement(\"span\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 44,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(LinkButton, {\n          onClick: () => this.showUpdate(user),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 45,\n            columnNumber: 13\n          }\n        }, \"\\u4FEE\\u6539\"), /*#__PURE__*/React.createElement(LinkButton, {\n          onClick: () => this.deleteUser(user),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 46,\n            columnNumber: 13\n          }\n        }, \"\\u5220\\u9664\"))\n      }];\n    };\n    this.initRoleName = roles => {\n      const roleNames = roles.reduce((pre, role) => {\n        pre[role._id] = role.name;\n        return pre;\n      }, {});\n      this.roleNames = roleNames;\n    };\n    this.getUsers = async () => {\n      const result = await reqUsers();\n      if (result.status === 0) {\n        const {\n          users,\n          roles\n        } = result.data;\n        this.initRoleName(roles);\n        this.setState({\n          users,\n          roles\n        });\n      } else {\n        _message.error(\"请求获取用户列表失败!\");\n      }\n    };\n    this.deleteUser = user => {\n      _Modal.confirm({\n        title: `确认删除${user.username}吗？`,\n        okType: 'danger',\n        okText: '确认',\n        cancelText: '取消',\n        onOk: async () => {\n          const result = await reqDeleteUser(user._id);\n          if (result.status === 0) {\n            _message.success(\"删除用户成功！\");\n            this.getUsers();\n          } else {\n            _message.error(\"删除用户失败！\");\n          }\n        }\n      });\n    };\n    this.showAdd = () => {\n      this.user = null; //删除修改用户时用到的this.user缓存，否则直接\n      this.setState({\n        isShow: true\n      });\n    };\n    this.showUpdate = user => {\n      this.user = user; //保存用户\n      this.setState({\n        isShow: true\n      });\n    };\n    this.addOrUpdateUser = async () => {\n      //收集输入数据\n      const user = this.form.getFieldsValue();\n      this.form.resetFields();\n      if (this.user) {\n        user._id = this.user._id;\n      }\n      //提交添加用户的请求\n      const result = await reqAddOrUpdateUser(user);\n      if (result.status === 0) {\n        _message.success(`请求${this.user ? '修改' : '添加'}用户成功！`);\n        this.setState({\n          isShow: false\n        });\n        this.getUsers();\n      } else {\n        _message.error(\"请求添加用户失败！\");\n      }\n      //更新状态\n    };\n  }\n\n  componentWillMount() {\n    this.initColumns();\n  }\n  componentDidMount() {\n    this.getUsers();\n  }\n  render() {\n    const {\n      users,\n      roles,\n      isShow\n    } = this.state;\n    const user = this.user || {};\n    const title = /*#__PURE__*/React.createElement(_Button, {\n      type: \"primary\",\n      onClick: this.showAdd,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 7\n      }\n    }, \"\\u521B\\u5EFA\\u7528\\u6237\");\n    return /*#__PURE__*/React.createElement(_Card, {\n      title: title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(_Table, {\n      rowKey: \"_id\"\n      // size=\"small\"\n      ,\n      dataSource: users,\n      columns: this.columns,\n      pagination: {\n        defaultPageSize: PAGE_SIZE\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(_Modal, {\n      title: user._id ? \"修改用户\" : \"创建用户\",\n      okText: \"\\u786E\\u8BA4\",\n      cancelText: \"\\u53D6\\u6D88\",\n      visible: isShow,\n      onOk: this.addOrUpdateUser,\n      onCancel: () => {\n        this.setState({\n          isShow: false\n        });\n        //重置输入内容\n        this.form.resetFields();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(UserForm, {\n      setForm: form => this.form = form,\n      roles: roles,\n      user: user,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 11\n      }\n    })));\n  }\n}","map":{"version":3,"names":["React","Component","formateDate","PAGE_SIZE","reqDeleteUser","reqUsers","reqAddOrUpdateUser","LinkButton","UserForm","User","state","users","roles","isShow","initColumns","columns","title","dataIndex","render","role_id","roleNames","user","showUpdate","deleteUser","initRoleName","reduce","pre","role","_id","name","getUsers","result","status","data","setState","error","confirm","username","okType","okText","cancelText","onOk","success","showAdd","addOrUpdateUser","form","getFieldsValue","resetFields","componentWillMount","componentDidMount","defaultPageSize"],"sources":["/Users/emmalu/Documents/fronted/workspace/react-admin_client-1/src/pages/user/user.jsx"],"sourcesContent":["import React, { Component } from \"react\";\nimport { Card, Modal, Table, Button, message } from \"antd\";\nimport { formateDate } from \"../../utils/dateUtils\";\nimport { PAGE_SIZE } from \"../../utils/constants\";\nimport { reqDeleteUser, reqUsers, reqAddOrUpdateUser } from \"../../api\";\nimport LinkButton from \"../../components/link-button/index\";\nimport UserForm from \"./user-form\";\n\n/* 用户管理路由 */\nexport default class User extends Component {\n  state = {\n    users: [], //需要展示的用户信息\n    roles: [], //所有角色列表\n    isShow: false, //是否显示添加/更新用户列表\n  };\n  initColumns = () => {\n    this.columns = [\n      {\n        title: \"用户名\",\n        dataIndex: \"username\",\n      },\n      {\n        title: \"邮箱\",\n        dataIndex: \"email\",\n      },\n      {\n        title: \"电话\",\n        dataIndex: \"phone\",\n      },\n      {\n        title: \"注册时间\",\n        dataIndex: \"create_time\",\n        render: formateDate,\n      },\n      {\n        title: \"所属角色\",\n        dataIndex: \"role_id\",\n        // render: (role_id) => this.state.roles.find(role => role._id === role_id).name\n        render: (role_id) => this.roleNames[role_id],\n      },\n      {\n        title: \"操作\",\n        render: (user) => (\n          <span>\n            <LinkButton onClick={() => this.showUpdate(user)}>修改</LinkButton>\n            <LinkButton onClick={() => this.deleteUser(user)}>删除</LinkButton>\n          </span>\n        ),\n      },\n    ];\n  };\n  /* 根据roles数组，生成包含所有角色名的对象（属性名用角色id值） */\n  initRoleName = (roles) => {\n    const roleNames = roles.reduce((pre, role) => {\n      pre[role._id] = role.name;\n      return pre;\n    }, {});\n    this.roleNames = roleNames;\n  };\n  /* 获取用户 */\n  getUsers = async () => {\n    const result = await reqUsers();\n    if (result.status === 0) {\n      const { users, roles } = result.data;\n      this.initRoleName(roles);\n      this.setState({ users, roles });\n    } else {\n      message.error(\"请求获取用户列表失败!\");\n    }\n  };\n  /* 删除指定用户 */\n  deleteUser = (user) => {\n    Modal.confirm({\n      title: `确认删除${user.username}吗？`,\n      okType: 'danger',\n      okText: '确认',\n      cancelText: '取消',\n      onOk: async () => {\n        const result = await reqDeleteUser(user._id);\n        if (result.status === 0) {\n          message.success(\"删除用户成功！\");\n          this.getUsers();\n        } else {\n          message.error(\"删除用户失败！\");\n        }\n      },\n    });\n  };\n  /* 显示创建用户界面 */\n  showAdd = () => {\n    this.user = null //删除修改用户时用到的this.user缓存，否则直接\n    this.setState({isShow: true})\n  }\n  /* 显示修改界面 */\n  showUpdate = (user) => {\n    this.user = user; //保存用户\n    this.setState({ isShow: true });\n  };\n  /* 添加/更新用户 */\n  addOrUpdateUser = async () => {\n    //收集输入数据\n    const user = this.form.getFieldsValue();\n    this.form.resetFields();\n    if(this.user){\n      user._id = this.user._id\n    }\n    //提交添加用户的请求\n    const result = await reqAddOrUpdateUser(user);\n    if (result.status === 0) {\n      message.success(`请求${this.user ? '修改' : '添加'}用户成功！`);\n      this.setState({ isShow: false });\n      this.getUsers();\n    } else {\n      message.error(\"请求添加用户失败！\");\n    }\n    //更新状态\n  };\n  componentWillMount() {\n    this.initColumns();\n  }\n  componentDidMount() {\n    this.getUsers();\n  }\n  render() {\n    const { users, roles, isShow } = this.state;\n    const user = this.user || {};\n    const title = (\n      <Button type=\"primary\" onClick={this.showAdd}>\n        创建用户\n      </Button>\n    );\n\n    return (\n      <Card title={title}>\n        <Table\n          rowKey=\"_id\"\n          // size=\"small\"\n          dataSource={users}\n          columns={this.columns}\n          pagination={{ defaultPageSize: PAGE_SIZE }}\n        />\n        <Modal\n          title={user._id ? \"修改用户\" : \"创建用户\"}\n          okText=\"确认\"\n          cancelText=\"取消\"\n          visible={isShow}\n          onOk={this.addOrUpdateUser}\n          onCancel={() => {\n            this.setState({ isShow: false })\n            //重置输入内容\n            this.form.resetFields()\n          }}\n        >\n          <UserForm setForm={(form) => (this.form = form)} roles={roles} user={user}/>\n        </Modal>\n      </Card>\n    );\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}